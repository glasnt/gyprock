<html>
<head>
<script src="js/jquery-1.11.1.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"/>
<link rel="stylesheet" type="text/css" href="css/font-awesome.min.css"/>
</head>
<style>
.form-inline {
    min-width: 0;
    width: auto;
    display: inline;
}
</style>

<body>

<div class="container">
	<div class="jumbotron">
		<h1>Gyprock</h1>
		<form id="user" class="form-inline">
		Generating <span id="dynoform"></span> wallpapers, just for you. <span id="message"></span>
		</form>
	</div>
	<form id="hides"><input type="hidden" id="w" /><input type="hidden" id="h"/></form>
	<div class="row marketing">
		<div class="col-lg-12">
			<% @wallpapers.each do |w| 
				%><a href="javascript:getWallpaper('<%= w %>')"><img src="<%= js_base_image w %>" class="preview"></a>
			<% end %>
		</div>
	</div>
	<footer class="footer">
		<p align="right">
		<a href="http://glasnt.com">glasnt</a> |
		<a href="http://github.com/glasnt/gyprock"><i class="fa fa-github-square"></i></a> | 
		<a href="http://twitter.com/glasnt"><i class="fa fa-twitter"></i></a>
		</p>
	</footer>	
</div>
<script>
var w = document.forms["user"]["width"] || window.screen.width
var h = window.screen.height

$(function() { 
	finalForm() 
});

function num(i) { 
	return (i === parseInt(i).toString()) ? true : false
}

function msg(msg, klass) { 
	$("#message").attr("class",klass).append(msg)
}

function getWallpaper(id) { 
	if (num(w) && num(h)) { 
		window.location.href = "wallpaper/"+id+"/"+w+"/"+h
	} else { 
		msg("Input not an integer.", "alert-danger")
	}
} 

function finalForm(){
	(location.hash === "form") ? inputForm() : textForm()
}

function in_vc(_id, _value) { 
	return $("<input/>", {id: _id,  type: "number", value: _value, style: "width:60px"})
}

function rs_dv(id) {
	var nf = "innerDyno";
	$(id).empty().append($("<span>", { id: nf, style: 'display:inline-flex'}))
	return "#"+nf
}

function loadNew() { 
	w =  document.forms["user"]["width"].value || w
	h =  document.forms["user"]["height"].value || h
	document.forms["hides"]["w"] = w
	document.forms["hides"]["h"] = h
} 

function inputForm() { 
	$(rs_dv("#dynoform")).append(in_vc("width", w))
			     .append($("<span>").append("x"))
			     .append(in_vc("height", h))
			     .append($("<button>", { class: "btn btn-sm", onclick: "loadNew(); textForm()"}).append($("<i>", {class:"fa fa-check"})))

	location.hash = "form"
}
function textForm() { 
	$(rs_dv("#dynoform")).attr("data-toggle","tooltip")
		       .attr("data-placement","bottom")
		       .attr("title","Is this wrong? Click to edit")
		       .click(function() { inputForm()})
		       .append("<span id='width' >"+w+"</span>")
		       .append("x")
		       .append("<span id='height'>"+h+"</span>")

	$('[data-toggle="tooltip"]').tooltip()

	location.hash = ""
}


</script>
</body>
</html>
